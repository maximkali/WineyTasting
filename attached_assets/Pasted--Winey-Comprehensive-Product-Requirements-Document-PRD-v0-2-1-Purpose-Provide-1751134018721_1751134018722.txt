**Winey â€“ Comprehensive Product Requirements Document (PRD) v0.2**

---

### **1. Purpose**

Provide a clear, deterministic blueprint for building **Winey**, a browserâ€‘based multiplayer wineâ€‘tasting game. The PRD captures every rule, edge case, data structure, and UI interaction required for an MVP implementation inside **Windsurf** (no-code / lowâ€‘code environment). The host will progressively feed sections of this PRD to Windsurfâ€™s AI agent; therefore, each section must be selfâ€‘contained and logically ordered.

### **2. Glossary**

| **Term** | **Definition** |
| --- | --- |
| **Bottle** | One of 20 wines entered by the host. Unique across the entire game. |
| **LabelÂ Name** | Required string that acts as humanâ€‘readable identifier (e.g., â€œObamaâ€). |
| **FunÂ Name** | Optional playful descriptor (â€œWetÂ SocksÂ Pinotâ€). Visible to players during rounds. |
| **Price** | Integer (USD). Hidden from players until final reveal. |
| **Round** | A tasting cycle with exactly 4 unique bottles. 5 rounds total (static). |
| **Submission** | A single playerâ€™s tasting notes + ranking for the 4 bottles in the current round. |
| **Leaderboard** | Ordered list of players by cumulative score. Updates only after a round ends. |
| **Sommelierâ€™sÂ Gambit** | Bonus section after all 5 rounds. Players guess most/least expensive bottle and pick a favorite. |
| **Host** | Player who sets up the game and controls the admin dashboard. |
| **Spectator** | User who visits join link but never submits a name. Readâ€‘only access. |

### **3. Fixed Game Parameters (MVP)**

- Players: **20** (exactly)
- Bottles: **20** (one per player, entered by host)
- Rounds: **5**
- Bottles per round: **4** (no repeats)
- Device model: Bringâ€‘yourâ€‘own (mobile responsive first)

### **4. Data Model (JSONâ€‘like)**

```
Game {
  id: UUID,
  status: enum['setup','lobby','in_round','countdown','reveal','gambit','final']
  currentRound: 1â€‘5,
  bottles: Bottle[20],
  rounds: Round[5],
  players: Player[â‰¤20],
  createdAt, updatedAt
}

Bottle {
  id: UUID,
  labelName: string (unique, required),
  funName: string (optional),
  price: integer (>=0),
  roundIndex: 0â€‘4 // assigned after randomization
}

Round {
  index: 0â€‘4,
  bottleIds: UUID[4],
  submissions: Submission[],
  revealed: boolean
}

Player {
  id: UUID,
  displayName: string,
  score: integer (default 0),
  isHost: boolean,
  status: enum['active','kicked','spectator']
}

Submission {
  playerId,
  roundIndex,
  tastingNotes: {
    bottleId: string (â‰¥10 chars) // repeated four times
  },
  ranking: [bottleId] // length 4 ordered $$$$â†’$
  locked: boolean
  points: integer 0â€‘4
}
```

### **5. Gameâ€‘State Timeline**

1. **Setup** â€“ host enters 20 bottles â†’ click *Randomize* â†’ link generated.
2. **Lobby** â€“ players join via link, enter name â†’ waiting room until host clicks *Start*.
3. **InÂ Round (1â€‘5)**
    - UI shows 4 bottles (Fun Names) + tasting note fields + dragâ€‘andâ€‘drop rank list.
    - Validation: all tasting notes â‰¥10 chars & ranking array length 4 & no duplicates.
    - On submit â†’ confirmation modal â†’ lock submission.
4. **Countdown** â€“ triggered automatically when submissions.length == playersActive **or** host clicks *CloseÂ Round*.
    - 10â€‘sec visible timer (host can *Undo* within first 3 seconds).
5. **Reveal** â€“ show correct order (Fun Names only), perâ€‘player score, updated leaderboard.
6. **Next Round** â€“ autoâ€‘advance after 15â€‘sec or host manual.
7. **Sommelierâ€™sÂ Gambit** â€“ after RoundÂ 5 only.
8. **Final** â€“ final leaderboard + full bottle list (price, label & fun names, roundIdx). Download button.

### **6. User Roles & Permissions**

| **Action** | **Host** | **Player** | **Spectator** |
| --- | --- | --- | --- |
| Enter bottles | âœ… | âŒ | âŒ |
| Start game | âœ… | âŒ | âŒ |
| Submit tasting notes & ranking | âœ… (if playing) | âœ… | âŒ |
| View leaderboard | âœ… | âœ… | âœ… |
| Close / undo / reopen round | âœ… | âŒ | âŒ |
| Kick / rename player | âœ… | âŒ | âŒ |
| End game early | âœ… | âŒ | âŒ |
| Download results | âœ… | âœ… | âœ… |

### **7. Detailed Flow Descriptions**

### **7.1 Game Setup (Host)**

1. *Create Game* â†’ enter display name (autoâ€‘host).
2. Bottle input form (20 rows, inline validation):
    - Label (required, unique, 3â€‘20 chars)
    - FunÂ Name (0â€‘40 chars)
    - Price (numeric â‰¥1)
3. *Randomize Bottles* allocates 4 bottle ids per round using a secure PRNG seeded with game.id to ensure deterministic order for auditing.
4. Display preview grid (Round vs Bottle Fun Name) for host verification.
5. Host clicks *Generate Link* â†’ lobby URL /join/{game.id} copied to clipboard.

### **7.2 Player Join & Lobby**

- Join screen: input name (3â€‘15 chars). If left blank â†’ spectator.
- Name uniqueness enforced (append #2 if conflict).
- Lobby shows list of players + host highlight + spectator count.
- Host can remove names preâ€‘start.
- Host presses *Start* â†’ round 1 begins.

### **7.3 Round Cycle Detail**

- **UI Layout** (mobile):
    1. Card stack of 4 Fun Names with tastingâ€‘note textarea under each.
    2. Sticky rank column ($$$$â†’$) with dropâ€‘targets.
- **Validation Rules**:
    - All 4 tasting notes â‰¥10 chars.
    - Rank list must contain exactly the 4 bottle ids, each once.
- **Submit â†’ Confirmation Modal** (prevent accidental): â€œYou cannot edit after submitting.â€ Buttons: *Cancel*, *Submit*.
- **Locked State**: fields disabled, banner â€œWaiting for othersâ€¦ (X/20 submitted)â€ + button to open leaderboard.
- **Host Close Round**: locks outstanding players automatically with zero points for that round.
- **Undo Close**: allowed for 3 seconds; afterwards countdown irreversible.

### **7.4 Countdown & Reveal**

- Global synchronized 10â€‘sec timer broadcast via WebSocket.
- During countdown, all inputs disabled.
- Reveal screen shows:
    - Ordered Fun Names list with crown icon on $$$$.
    - Table of players with round points.
    - Animated slideâ€‘in leaderboard (cumulative).
- Button: â€œNext Roundâ€ appears for host after 10â€‘sec grace.

### **7.5 Sommelierâ€™s Gambit**

- Shown only if all 5 rounds completed.
- UI: picker list of 20 Fun Names.
- Validation: must choose 1 for Most Expensive, 1 for Least Expensive (cannot be same id), and 1 Favorite (may overlap).
- Scoring engine adds +2 points per correct expensive/cheap guess, updates leaderboard.

### **7.6 Final Summary**

- Sections:
    1. Winner banner + final leaderboard.
    2. Playerâ€™s personal card with their Gambit selections and whether they scored.
    3. Master Bottle Table sorted by price desc.
- Buttons: *Download PDF*, *Copy Link for Spectators*.

### **8. Admin Dashboard (Hostâ€‘only overlay)**

- Floating gear icon â†’ opens sideâ€‘panel with tabs:
    1. **Status** â€“ live round, countdown timer, submission progress bar.
    2. **Players** â€“ list (searchable), actions: Rename, Kick.
    3. **Controls** â€“ Close Round / Undo, Reopen Round (select player), Advance, End Game Early.
- Audit log visible for transparency.

### **9. Spectator Mode**

- Autoâ€‘redirect to /spectate/{game.id}.
- Display:
    - Current round progress bar.
    - Leaderboard (last completed round).
    - Reveal animations.
- No forms; emits spectator=true flag to socket for lighter traffic.

### **10. Scoring Engine**

```
function scoreRound(correctOrder: string[], playerRank: string[]): number {
  let pts = 0;
  for (let i = 0; i < 4; i++) if (correctOrder[i] === playerRank[i]) pts++;
  return pts;
}
```

- Cumulative player.score += pts.
- Gambit bonuses applied after base total.
- Kicked or absent players maintain current score; no future submissions.

### **11. Randomization Algorithm**

- Use crypto.getRandomValues (browser) or serverâ€‘side seedrandom(game.id).
- Assign bottle index i into round Math.floor(i/4) after shuffle.
- Deterministic for replay debugging by reseeding with the same game.id.

### **12. UI / UX Style Guide**

- **Typography**: Inter or similar. Header 24â€‘32px, body 16px.
- **Color Tokens**: wineâ€‘red #8A1538, rosÃ© #F4C4CF, gold #F6EDCF, sage #D6E1CF, charcoal #222.
- Buttons: pillâ€‘shape, 12â€‘px radius, solid fill with subtle gradient.
- Animation: Fadeâ€‘slide 150â€‘ms, cubicâ€‘bezier(.4,.0,.2,1).
- Emojis sparingly: countdown â€œâ³â€, reveal â€œğŸ·ğŸ”¥â€, crown â€œğŸ‘‘â€.

### **13. Security & Privacy**

- Join link contains 8â€‘char slug + 4â€‘digit PIN (embedded in URL fragment so PIN not sent to server on GET).
- Host token stored in localStorage.
- WebSocket auth via gameId + playerId + token signed JWT.
- All prices encrypted in transit and never broadcast until final summary.

### **14. Error Handling & Edge Cases**

| **Edge Case** | **Expected Behaviour** |
| --- | --- |
| Player disconnects midâ€‘round | Their submission remains if already locked; if not submitted, host may Close Round or Reopen later. |
| Duplicate label names on setup | Inline error, must be unique. |
| Host refreshes browser | Host token reâ€‘auths â†’ dashboard restored. |
| Less than 20 players join | Allowed; missing players treated as empty seats with 0 score. |
| Host ends game early | Skip Gambit, compute totals only from completed rounds. |
| Undo window expired | Countdown cannot be cancelled. |

### **15. Analytics**

- Events: game_start, submit_round, round_reveal, gambit_start, final_download.
- Basic metrics: avg submission time, tasting note length, distribution of score.

### **17. Logic Safeguards & Clarifications**

- **Unique Prices Required:** Host must enter distinct prices for all 20 bottles to avoid ambiguous rankings. Inline validation enforces uniqueness.
- **Duplicate Fun Names Handling:** Fun Name does not need to be unique; if duplicates exist, the UI automatically appends a numeric suffix during reveals (e.g., â€œWet Socks Pinot #2â€) to disambiguate.
- **Leaderboard Tie-Breaker:** Players with identical total scores share the same rank. Within that rank, they are ordered alphabetically by displayName. No extra playoff.
- **Input Length & Sanitization:**
    - Tasting notes: 10â€“300 characters, HTML stripped.
    - Label/Fun names: 3â€“40 characters, no angle brackets or scripts.
- **Host Reassignment:** If the host disconnects > 60 s, the earliest-joined active player is auto-promoted to host. Original host regains permissions on reconnect.
- **Kicked Player Scoring:** A kicked player keeps points already earned but is excluded from unfinished rounds and Sommelierâ€™s Gambit.
- **Duplicate Label Check:** Label Names are case-insensitive unique; validation blocks duplicates.
- **Round Integrity Check:** Server confirms every active player has a locked submission before calculating reveal. Missing submissions = 0 points and flagged in audit log.

### **18. Future Roadmap (postâ€‘MVP)**

- Variable player & round counts.
- Email results (SendGrid) + CSV export.
- OAuth login for persistent profiles.
- Team play mode (groups of 2â€‘4).
- AI tastingâ€‘note suggestions.

---

> Incremental Delivery â€“ Revised Build Roadmap (Bugâ€‘Minimized)
> 

> 
> 

> Phase 0 â€“ Environment & Skeleton
> 
- Spin up Windsurf project, repo, linter, CI.

> 
> 

> Phase 1 â€“ Core Schema & Utilities
> 
1. Section **4. Data Model**
2. Section **11. Randomization Algorithm**
3. Section **10. Scoring Engine**

> 
> 

> Phase 2 â€“ State Machine & Security
> 

> 4. Section
> 
> 
> **5. Gameâ€‘State Timeline**
> 

> 5. Section
> 
> 
> **13. Security & Privacy**
> 

> 
> 

> Phase 3 â€“ Admin & Permissions Backbone
> 

> 6. Section
> 
> 
> **6. User Roles & Permissions**
> 

> 7. Section
> 
> 
> **8. Admin Dashboard**
> 

> 
> 

> Phase 4 â€“ Preâ€‘Game Flows
> 

> 8. Section
> 
> 
> **7.1 Game Setup (Host)**
> 

> 9. Section
> 
> 
> **7.2 Player Join & Lobby**
> 

> 
> 

> Phase 5 â€“ Core Gameplay Loop
> 

> 10. Section
> 
> 
> **7.3 Round Cycle Detail**
> 

> 11. Section
> 
> 
> **7.4 Countdown & Reveal**
> 

> 12. Section
> 
> 
> **6. Leaderboard Rules**
> 

> 
> 

> Phase 6 â€“ Postâ€‘Gameplay & Spectator
> 

> 13. Section
> 
> 
> **7.5 Sommelierâ€™s Gambit**
> 

> 14. Section
> 
> 
> **7.6 Final Summary**
> 

> 15. Section
> 
> 
> **9. Spectator Mode**
> 

> 
> 

> Phase 7 â€“ Polish & Hardening
> 

> 16. Section
> 
> 
> **12. UI / UX Style Guide**
> 

> 17. Section
> 
> 
> **14. Error Handling & Edge Cases**
> 

> 18. Section
> 
> 
> **15. Analytics**
> 

> 
> 

> Phase 8 â€“ Future Enhancements
> 

> 19. Section
> 
> 
> **16. Roadmap (outâ€‘ofâ€‘scope for MVP)**
> 

> 
> 

> This order builds outward from immutable data & deterministic logic â†’ security â†’ admin control â†’ player flows â†’ UX polish. Each phase compiles and passes tests before progressing, minimizing crossâ€‘module regression risk.
>